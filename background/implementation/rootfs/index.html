<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">

        <title>Implementation/Rootfs - embEDUx Project</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../../index.html">embEDUx Project</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../usage/usage/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/common/build-monitoring/index.html">Common/Build Monitoring</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/uboot/index.html">Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/linux/index.html">Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/rootfs/index.html">Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/rootfs/advanced/run-containers/index.html">Rootfs/Advanced/Run Containers</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/rootfs/configuration.yml/index.html">Rootfs/Configuration.Yml</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/misc/index.html">Misc</a>
                        </li>
                    
                        <li >
                            <a href="../../../usage/flashtool/index.html">Flashtool</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../setup/setup/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/repositories/index.html">Repositories</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/adminstation/index.html">Adminstation</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/buildserver/index.html">Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/buildserver/customize-buildslaves/index.html">Buildserver/Customize Buildslaves</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/buildserver/customize-supported-platforms/index.html">Buildserver/Customize Supported Platforms</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/post-install/build-qemu-kernels/index.html">Post Install/Build Qemu Kernels</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/post-install/toolchains/index.html">Post Install/Toolchains</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/post-install/user-documentation/index.html">Post Install/User Documentation</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/workstation/index.html">Workstation</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/flashtool/deployment/index.html">Flashtool/Deployment</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/flashtool/deployment/add-new-deployment/index.html">Flashtool/Deployment/Add New Deployment</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/flashtool/deployment/add-recipe-file/index.html">Flashtool/Deployment/Add Recipe File</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/examples/user-documentation-DEMO/index.html">Examples/User Documentation Demo</a>
                        </li>
                    
                        <li >
                            <a href="../../../setup/examples/user-documentation-HTWG/index.html">Examples/User Documentation Htwg</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Background <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../background/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../requirements/index.html">Requirements</a>
                        </li>
                    
                        <li >
                            <a href="../../design/index.html">Design</a>
                        </li>
                    
                        <li >
                            <a href="../../design/bootloader/index.html">Design/Bootloader</a>
                        </li>
                    
                        <li >
                            <a href="../../design/buildserver/index.html">Design/Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../../design/continuous-integration/index.html">Design/Continuous Integration</a>
                        </li>
                    
                        <li >
                            <a href="../../design/flashtool/index.html">Design/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../design/linux/index.html">Design/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../design/repositories/index.html">Design/Repositories</a>
                        </li>
                    
                        <li >
                            <a href="../../design/rootfs/index.html">Design/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../design/toolchain/index.html">Design/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/index.html">Evaluation</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/buildroot/index.html">Evaluation/Buildroot</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/buildserver-setuproutine/index.html">Evaluation/Buildserver Setuproutine</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/container-utility/index.html">Evaluation/Container Utility</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/continuous-integration/index.html">Evaluation/Continuous Integration</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/flashtool/index.html">Evaluation/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/linux/index.html">Evaluation/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/rootfs/index.html">Evaluation/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/toolchain/index.html">Evaluation/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/uboot/index.html">Evaluation/Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../evaluation/yocto-project/index.html">Evaluation/Yocto Project</a>
                        </li>
                    
                        <li >
                            <a href="../index.html">Implementation</a>
                        </li>
                    
                        <li >
                            <a href="../buildserver/index.html">Implementation/Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../flashtool/index.html">Implementation/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../flashtool/code-documentation/index.html">Implementation/Flashtool/Code Documentation</a>
                        </li>
                    
                        <li >
                            <a href="../linux/index.html">Implementation/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../misc/index.html">Implementation/Misc</a>
                        </li>
                    
                        <li >
                            <a href="../repositories-and-branches/index.html">Implementation/Repositories And Branches</a>
                        </li>
                    
                        <li class="active">
                            <a href="index.html">Implementation/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../toolchain/index.html">Implementation/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../uboot/index.html">Implementation/Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../summary/index.html">Summary</a>
                        </li>
                    
                        <li >
                            <a href="../../terminology/index.html">Terminology</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../troubleshooting/troubleshooting/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../troubleshooting/entering-build-environment/index.html">Entering Build Environment</a>
                        </li>
                    
                        <li >
                            <a href="../../../troubleshooting/faq/index.html">Faq</a>
                        </li>
                    
                        <li >
                            <a href="../../../troubleshooting/local-testing/index.html">Local Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../../troubleshooting/rootfs/entering-build-environment/index.html">Rootfs/Entering Build Environment</a>
                        </li>
                    
                        <li >
                            <a href="../../../troubleshooting/rootfs/monitoring-package-installation/index.html">Rootfs/Monitoring Package Installation</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../support/contact-team/index.html">Contact Team</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../repositories-and-branches/index.html">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../toolchain/index.html">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#rootfs-build-implementation">RootFS Build Implementation</a></li>
        
            <li><a href="#steps">Steps</a></li>
        
            <li><a href="#context-awareness">Context Awareness</a></li>
        
            <li><a href="#nativecross-rootfs-detection">Native/Cross RootFS Detection</a></li>
        
            <li><a href="#plays-overview">Plays Overview</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="rootfs-build-implementation">RootFS Build Implementation</h1>
<p>This chapter explains the implementation of the RootFS build routine. According
to the <a href="../../evaluation/rootfs/index.html">RootFS evaluation results</a>, <strong>Ansible</strong> has
been used for the implementation. </p>
<p>The implementation is available online in the <a href="https://github.com/embEDUx/rootfs-buildroutine">RootFS build routine
repository</a>.</p>
<h2 id="steps">Steps</h2>
<p>The necessary steps for the RootFS Build routine have already been specified in
the <a href="../../../rootfs-build-routine-steps">corresponding evaluation chapter</a>. As it can be
seen there, the build steps are different for native and cross containers.
Therefore, the RootFS build routine needs to be aware of the context.</p>
<h2 id="context-awareness">Context Awareness</h2>
<p>The RootFS build process is triggered for every change in the RootFS product
specifications repository. Please have a look at the following picture,
especially how the build delegation to the RootFS containers is visualized. </p>
<p><a href="../../../background/img/post-eval_result_design_rootfs.png"><img alt="" src="../../../background/img/post-eval_result_design_rootfs.png" /></a></p>
<p>According to the design and evaluation results, the RootFS build routine can
either be run in a RootFS container for the native or cross architecture. </p>
<h2 id="nativecross-rootfs-detection">Native/Cross RootFS Detection</h2>
<p>Both scenarios must be handled differently. Environment variables are used to
indicate the target architecture in the buildslave container. A comparison of
the target architecture and the detected native architecture indicates whether
the build routine must handle a native or cross target RootFS. The build routine
involves setting up the build environment depending on whether it is a cross
container or not.</p>
<h2 id="plays-overview">Plays Overview</h2>
<p>Altogether, the build routine consists of 10 plays. The following table gives a
brief overview about all the plays. The host column is directly taken from the
<code>ansible-playbook --list-tasks</code> commands, and gives some insight how the host
organization options have been used. The example shows the procedure for a fresh
build environment. Some of these steps are automatically skipped on subsequent
build jobs, e.g. play #3 and #6.</p>
<table>
<thead>
<tr>
<th>Play #</th>
<th>Cross/Native</th>
<th>Host</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td>#1</td>
<td>both</td>
<td>localhost</td>
<td>Native/Cross detection and fact assignment</td>
</tr>
<tr>
<td>#2</td>
<td>both</td>
<td>localhost</td>
<td>Download stage3; Prepare and mount the RootFS image; Unpack stage3; Sync portage tree</td>
</tr>
<tr>
<td>#3</td>
<td>cross</td>
<td>localhost</td>
<td>Create dummy hosts group for cross targets</td>
</tr>
<tr>
<td>#4</td>
<td>cross</td>
<td>localhost_cross</td>
<td>Download and unpack Qemu kernel files</td>
</tr>
<tr>
<td>#5</td>
<td>cross</td>
<td>target_cross</td>
<td>Estimate the crossdev parameters</td>
</tr>
<tr>
<td>#6</td>
<td>cross</td>
<td>localhost_cross</td>
<td>Build the cross-toolchain using crossdev; Setup distccd</td>
</tr>
<tr>
<td>#7</td>
<td>both</td>
<td>localhost</td>
<td>Start the target system accordingly (Qemu or proot)</td>
</tr>
<tr>
<td>#8</td>
<td>both</td>
<td>target</td>
<td><strong>Copy Pre-Overlay; Run Pre-Install-Comands; Install Packages</strong></td>
</tr>
<tr>
<td>#9</td>
<td>both</td>
<td>target</td>
<td><strong>Copy Post-Overlay; Run Post-Install-Comands</strong></td>
</tr>
<tr>
<td>#10</td>
<td>both</td>
<td>localhost</td>
<td>Pack the RootFS content and Portage Snapshots</td>
</tr>
</tbody>
</table>
<h4 id="notes">Notes</h4>
<p>The actions that are <strong>marked bold</strong> process the <strong>configuration.yml and overlay
directories</strong> that have been stored in the RootFS product specification
repository. If you are interested in an example, please have a look at the
<a href="../../../usage/rootfs/index.html#repository-file-structure">RootFS Usage page</a>.</p>
<p>The table has been simplified, since all plays consists of a total of 137 tasks.
Please investigate the <a href="https://github.com/embEDUx/rootfs-buildroutine">source code of the build
routine</a> if you are interested
in more details.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/prettify-1.0.min.js"></script>
        <script src="../../../js/base.js"></script>
    </body>
</html>