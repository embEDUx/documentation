<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">

        <title>Flashtool/Deployment/Add New Deployment - embEDUx Project</title>

        <link href="../../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../../../index.html">embEDUx Project</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../../usage/usage/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/common/build-monitoring/index.html">Common/Build Monitoring</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/uboot/index.html">Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/linux/index.html">Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/rootfs/index.html">Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/rootfs/advanced/run-containers/index.html">Rootfs/Advanced/Run Containers</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/rootfs/configuration.yml/index.html">Rootfs/Configuration.Yml</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/misc/index.html">Misc</a>
                        </li>
                    
                        <li >
                            <a href="../../../../usage/flashtool/index.html">Flashtool</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../setup/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../repositories/index.html">Repositories</a>
                        </li>
                    
                        <li >
                            <a href="../../../adminstation/index.html">Adminstation</a>
                        </li>
                    
                        <li >
                            <a href="../../../buildserver/index.html">Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../../../buildserver/customize-buildslaves/index.html">Buildserver/Customize Buildslaves</a>
                        </li>
                    
                        <li >
                            <a href="../../../buildserver/customize-supported-platforms/index.html">Buildserver/Customize Supported Platforms</a>
                        </li>
                    
                        <li >
                            <a href="../../../post-install/toolchains/index.html">Post Install/Toolchains</a>
                        </li>
                    
                        <li >
                            <a href="../../../post-install/user-documentation/index.html">Post Install/User Documentation</a>
                        </li>
                    
                        <li >
                            <a href="../../../workstation/index.html">Workstation</a>
                        </li>
                    
                        <li >
                            <a href="../../../workstation/flashtool/index.html">Workstation/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../index.html">Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../index.html">Flashtool/Deployment</a>
                        </li>
                    
                        <li class="active">
                            <a href="index.html">Flashtool/Deployment/Add New Deployment</a>
                        </li>
                    
                        <li >
                            <a href="../add-recipe-file/index.html">Flashtool/Deployment/Add Recipe File</a>
                        </li>
                    
                        <li >
                            <a href="../../../examples/user-documentation-DEMO/index.html">Examples/User Documentation Demo</a>
                        </li>
                    
                        <li >
                            <a href="../../../examples/user-documentation-HTWG/index.html">Examples/User Documentation Htwg</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Background <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../../background/background/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/requirements/index.html">Requirements</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/index.html">Design</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/bootloader/index.html">Design/Bootloader</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/buildserver/index.html">Design/Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/continuous-integration/index.html">Design/Continuous Integration</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/flashtool/index.html">Design/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/linux/index.html">Design/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/repositories/index.html">Design/Repositories</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/rootfs/index.html">Design/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/design/toolchain/index.html">Design/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/index.html">Evaluation</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/buildroot/index.html">Evaluation/Buildroot</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/buildserver-setuproutine/index.html">Evaluation/Buildserver Setuproutine</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/container-utility/index.html">Evaluation/Container Utility</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/continuous-integration/index.html">Evaluation/Continuous Integration</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/flashtool/index.html">Evaluation/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/linux/index.html">Evaluation/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/rootfs/index.html">Evaluation/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/toolchain/index.html">Evaluation/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/uboot/index.html">Evaluation/Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/evaluation/yocto-project/index.html">Evaluation/Yocto Project</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/index.html">Implementation</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/buildserver/index.html">Implementation/Buildserver</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/flashtool/index.html">Implementation/Flashtool</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/linux/index.html">Implementation/Linux</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/misc/index.html">Implementation/Misc</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/repositories-and-branches/index.html">Implementation/Repositories And Branches</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/rootfs/index.html">Implementation/Rootfs</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/toolchain/index.html">Implementation/Toolchain</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/implementation/uboot/index.html">Implementation/Uboot</a>
                        </li>
                    
                        <li >
                            <a href="../../../../background/terminology/index.html">Terminology</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../../troubleshooting/troubleshooting/index.html">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../../../troubleshooting/entering-build-environment/index.html">Entering Build Environment</a>
                        </li>
                    
                        <li >
                            <a href="../../../../troubleshooting/faq/index.html">Faq</a>
                        </li>
                    
                        <li >
                            <a href="../../../../troubleshooting/local-testing/index.html">Local Testing</a>
                        </li>
                    
                        <li >
                            <a href="../../../../troubleshooting/rootfs/entering-build-environment/index.html">Rootfs/Entering Build Environment</a>
                        </li>
                    
                        <li >
                            <a href="../../../../troubleshooting/rootfs/monitoring-package-installation/index.html">Rootfs/Monitoring Package Installation</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../../../support/contact-team/index.html">Contact Team</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../index.html">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../add-recipe-file/index.html">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#add-a-new-deployment-procedure">Add A New Deployment Procedure</a></li>
        
            <li><a href="#common-procedure-for-a-developer">Common Procedure For A Developer</a></li>
        
            <li><a href="#general-structure-of-a-recipe-file">General structure of a recipe file</a></li>
        
            <li><a href="#recipe-skeletons-and-their-python-representation">Recipe Skeletons And Their Python Representation</a></li>
        
            <li><a href="#structure-of-the-setup-module-of-the-flashtool">Structure Of The Setup Module Of The Flashtool</a></li>
        
            <li><a href="#information-to-write-in-this-chapter">Information to write in this chapter</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="add-a-new-deployment-procedure">Add A New Deployment Procedure</h1>
<p><strong>(work in progress)</strong></p>
<p>This chapter describes how to implement new recipe types for the deployment
procedure. If you are unsure about the concept of recipe files for the
<strong>Flashtool</strong> please read the chapter <a href="../index.html">Deployment with the Flashtool</a>
and <a href="../add-recipe-file/index.html">Writing a new recipe file</a> first.</p>
<h2 id="common-procedure-for-a-developer">Common Procedure For A Developer</h2>
<p>(TODO)</p>
<h2 id="general-structure-of-a-recipe-file">General structure of a recipe file</h2>
<p>The recipe files for the <strong>Flashtool</strong> are written in 
<a href="http://yaml.org/">YAML-Syntax</a>. The next example shows the general structure
of a recipe file.</p>
<pre><code class="yaml">---
type: # name of recipe type

recipe: 
    # specific configurations of the recipe
    # ...

---
type: # next recipe

recipe:
    # ...
</code></pre>

<p>The <code>---</code> is necessary to indicate a <em>YAML-document</em>. The example shows that a
recipe file can contain multiple <em>YAML-documents</em>. There must be at least one of
it.
Every <em>YAML-document</em> must contain a <em>type</em> keyword and a <em>recipe</em> keyword. The
content of the <em>recipe</em> section depends on the selected type. This is shown
in the next chapter.</p>
<h2 id="recipe-skeletons-and-their-python-representation">Recipe Skeletons And Their Python Representation</h2>
<p>A recipe file is written in <em>YAML-Syntax</em> an can easily read in by python. To
avoid errors from the author of the recipe file, the given key value pairs in
the recipe files, are parsed and checked by the <strong>Flashtool</strong>. The <strong>Flashtool</strong>
provides an interface for new recipe skeletons.</p>
<h2 id="structure-of-the-setup-module-of-the-flashtool">Structure Of The Setup Module Of The Flashtool</h2>
<p>A new recipe skeleton for a deployment must be defined
and implemented in python. The next figure will show the structure of the 
setup part of the <strong>Flashtool</strong>.</p>
<pre><code>./setup
├── init.py 
├── deploy
│   ├── __init__.py
│   ├── ...
│   └── mmc.py
│ 
├── recipe
│   ├── __init__.py
│   ├── ...
│   └── mmc.py
...
</code></pre>

<p>The <strong>Flashtool</strong> will read in the recipe file from top to bottom. Each <em>YAML 
document</em> in the recipe file represents a recipe skeleton. The type of the recipe 
skeleton is given by the key <code>type</code>. Only values are allowed which are mapped 
as python file in the deploy and recipe directory. </p>
<p>According to the directory structure above the user can only state the recipe 
skeleton for <em>MMC</em> devices (<code>type: mmc</code>).</p>
<h3 id="python-representation-of-a-recipe-skeleton">Python Representation Of A Recipe Skeleton</h3>
<p>The next example will show you how to implement a python representation for a 
recipe skeleton. Let's create recipe skeleton for a <em>HDD</em> device. </p>
<ol>
<li>
<p>Specify a <em>YAML document</em> with all keywords which the recipe skeleton for
   <em>hdd</em> devices should have. The keywords for the recipe must be stated in the
   <code>recipe:</code> section.  If you do not know how the <em>YAML</em> syntax look like,
   please have a closer look <a href="http://www.yaml.org/spec/1.2/spec.html#id2759963">here</a>.</p>
<pre><code>---
type: hdd

recipe:
    partition_type:
    partition:
        - name: 
          fs_type:
          size:
          flags:
</code></pre>
<p>The python representation must check the <em>YAML document</em> for the keywords 
<em>partition_type</em>, <em>paritition</em> and for every partition the keywords 
<em>name</em>, <em>fs_type</em>, <em>size</em> and <em>flags</em>.</p>
<p>The recipe file will be parsed with the <a href="http://pyyaml.org/">PyYaml</a> module.
The <em>YAML document</em> above will be represented in python as the following
structure.</p>
<pre><code>{
    'type' : 'HDD',
    'recipe' : {
        partition_type : None,
        partitions : [
            {
                name : None
                fs_type : None,
                size : None,
                flags : None,
            }
        ],
    },
}
</code></pre>
<p>The setup routine will read the value of <em>type</em> and search for a python
representation in the recipe directory (In this case the file <em>flashtool
/setup/recipe/hdd.py</em>). When found it will pass the values of <em>recipe</em> into
the constructor of the python class (In this case <em>HDD</em>). Of course there is
no class defined at <em>flashtool/setup/recipe/hdd.py</em>, this brings us to step
two.</p>
</li>
<li>
<p>Implement python representation for the recipe. The python representation of 
    the recipe type is a python class and should have the same name written in 
    <em>CAPITAL</em> letters and must inherit from the class <em>YAML</em>.</p>
<pre><code>from flashtool.setup.recipe import YAML

class HDD(YAML):
    ...
</code></pre>
<p>The valid keywords for the recipe must be added in a class attribute named
<em>attr</em>. In this case we will provide a second class for the keyword
<em>partition</em>. The constructor must also provide a parameter called
<em>attributes</em>.</p>
<pre><code>...
class HDD(YAML):
    attr = ['partition_type', 'partitions']

    def __init__(self, attributes):
        self.check_attributes(attributes)
        ... # DO SOME VALUE CHECKS HERE
        parts = []
        for part_attr in attributes['partitions']:
            part = Partition(part_attr)
            parts.append(part)
        attributes['partitions'] = parts
        YAML.__init__(self, attributes)

class Partition(YAML):
    attr = ['name', 'fs_type', 'size', 'flags']

    def __init__(self, attributes):
        self.check_attributes(attributes)
        ... # DO SOME VALUE CHECKS HERE
        YAML.__init__(self, attributes)

__entry__ = HDD
</code></pre>
<p>The classes inherit the method <code>check_attributes(self, attributes)</code> from the
super class <em>YAML</em>. It will check if the given attributes contains all
keywords given in the class member <em>attr</em>. If not a exception will be
raised.</p>
<p>The last statement of the constructor is the call of the constructor of the
super class <em>YAML</em>. It will save the attributes as attributes of the created
object. It is now pssible to access the values of the attributes vith the
dot <code>.</code> operator.</p>
<pre><code>hdd_obj.partition_type  # get partition types
hdd_obj.partitions      # get list of partitions
</code></pre>
<p>The module variable <strong>entry</strong> must be set with the class name of the
implemented recipe class. With this value the <strong>Flashtool</strong> can create an
instance of the new recipe class. </p>
</li>
<li>
<p>Load attribute:
    The load structure can be used to map the software components to the defined
    partitions. To add this structure to your recipe type you have to do the
    following steps:</p>
<ol>
<li>
<p>Add the keyword <em>load</em> to the <em>attr</em> class member of your python class
    first (In this example HDD).</p>
<pre><code>attr = ['paritions', 'partition_table', 'load']
</code></pre>
</li>
<li>
<p>Pass the value of the attribute <em>load</em> to the constructor of the class
   <em>Load</em> and save the <em>Load</em> object as new value of the <em>load</em> attribute.</p>
<pre><code>from flashtool.setup.recipe import Load
...
    attributes['load'] = Load(attributes['load'])
    YAML.__init__(self, attributes)
</code></pre>
</li>
</ol>
<p>Now the user can use the <em>load</em> structure in the <em>hdd</em> recipe 
    ---
    type: hdd</p>
<pre><code>recipe:
    partition_type:
    partition:
        - name: 
          fs_type:
          size:
          flags:

    load: 
        Uboot:
            device: 
        Linux_Boot:
            device: 
        Linux_Root:
            device: 
            ...
</code></pre>
</li>
<li>
<p>Now we can add a deploy class for the <em>hdd</em> recipe type. This class must be
    stated in the file <em>hdd.py</em> and inherit from the super class Deploy. The 
    following constructor and methods must be implemented for this class.</p>
<pre><code>`def __init__(self, recipe, actions, builds, platform, auto)`
`def prepare(self)`
`def load(self)`
</code></pre>
<p>The setup routine will search for a python file with the name <em>hdd.py</em> in
the directory <em>deploy</em>. The module variable <code>__entry__</code> must be set with the 
class name of the implemented deploy class. Let's call this class
<code>HddDeploy</code>. The following example will show the structure of the python
file.</p>
<pre><code>from flashtool.setup.deploy import Deploy
# other imports

class HddDeploy(Deploy):

    def __init__(self, recipe, actions, builds, platforms, auto):
        # do initialization steps for the class ...

    def prepare(self):
        # code for preparation steps of the hardware, like partition
        # the device

    def load(self):
        # loading products to the device.

__entry__ = HddDeploy
</code></pre>
<p>The setup routine will call first all <code>prepare()</code> methods of all objects
which were specified in the <em>YAML</em> file and then all <code>load()</code> methods.</p>
</li>
</ol>
<h2 id="information-to-write-in-this-chapter">Information to write in this chapter</h2>
<p><strong>Attention: the setup routine only allows to deploy products on platforms
which use a mmc device as storage media. Support for other storage media must be implemented.</strong></p>
<p>If you want to implement new features to the <strong>Flashtool</strong>, please consider
reading the development section for the <strong>Flashtool</strong>. The new functionality
must be triggered by a recipe file an must be explained in the <a href="#recipe-files">recipe
files</a> chapter.</p>
<p>The setup procedure requires an existing <a href="#How_to_write_a_recipe_file">recipe</a> 
file.</p>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../../js/prettify-1.0.min.js"></script>
        <script src="../../../../js/base.js"></script>
    </body>
</html>